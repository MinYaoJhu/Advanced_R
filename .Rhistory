c("year", "month", "week", "day", "hour", "minute", "second")
)
test_period
str(test_period)
per <- lubridate::period()
tibble(name=slotNames(per),
class=map_chr(name, ~ class(getElement(per, .x))))
library(tidyverse)
per <- lubridate::period()
tibble(name=slotNames(per),
class=map_chr(name, ~ class(getElement(per, .x))))
decimal_second(test_period)
second(test_period)
decimal_second(test_period)
lubridate::decimal_second(test_period)
setClass("Human")
new("Human")
setClass("Programmer", contains = "Human")
setClass("Programmer", contains = "Human")
new("Human")
setClass("Programmer", contains = "Human")
new("Programmer")
str(Programmer)
setClass("Programmer", contains = "Human")
P <- new("Programmer")
str(P)
setClass("Programmer", contains = "Human")
Programmer <- new("Programmer")
str(Programmer)
Programmer <- new("Programmer")
str(Programmer)
setClass("Programmer", contains = "Human")
new("Programmer")
Programmer <- new("Programmer")
str(Programmer)
per <- lubridate::period()
str(per)
tibble(name=slotNames(per),
class=map_chr(name, ~ class(getElement(per, .x))))
second(test_period)
setGeneric("age", function(x) standardGeneric("age"))
setGeneric("age<-", function(x, value) standardGeneric("age<-"))
setMethod("age", "Person", function(x) x@age)
setMethod("age<-", "Person", function(x, value) {
x@age <- value
x
})
age(john) <- 50
age(john)
setMethod("age", "Person", function(x) x@age)
setMethod("age<-", "Person", function(x, value) {
x@age <- value
validObject(x)
x
})
age(john) <- 50
age(john)
setGeneric("age", function(x) standardGeneric("age"))
setGeneric("age<-", function(x, value) standardGeneric("age<-"))
setMethod("show", "Person", function(object) {
cat(is(object)[[1]], "\n",
"  Name: ", object@name, "\n",
"  Age:  ", object@age, "\n",
sep = ""
)
})
john
#> Person
#>   Name: John Smith
#>   Age:  50
john
john@name
is(john)
.Person <- setClass(
"Person",
slots = c(name = "character", age = "numeric")
)
hadley <- .Person(name = "Hadley")
hadley
formals("show")
setMethod("show", "Person", function(object) {
cat(object@name, "creates hard exercises")
})
hadley
setMethod("show", "Person", function(x) {
cat(x@name, "creates hard exercises")
})
hadley
setMethod("show", "Person", function(x, y) {
cat(x@name, "is", x@age, "years old")
})
setMethod("show", "Person", function(object, y) {
cat(object@name, "is", object@age, "years old")
})
.Person <- setClass(
"Person",
slots = c(name = "character", age = "numeric")
)
hadley <- .Person(name = "Hadley", age = 30)
hadley
.Person <- setClass(
"Person",
slots = c(name = "character", age = "numeric")
)
hadley <- .Person(name = "Hadley", age = 30)
hadley
formals("show")
setMethod("show", "Person", function(object) {
cat(object@name, "creates hard exercises")
})
hadley
setMethod("show", "Person", function(x) {
cat(x@name, "creates hard exercises")
})
hadley
setMethod("show", "Person", function(x, y) {
cat(x@name, "is", x@age, "years old")
})
setMethod("show", "Person", function(object, y) {
cat(object@name, "is", object@age, "years old")
})
setMethod("show", "Person", function(object) {
cat(object@name, "is", object@age, "years old")
})
setMethod("show", "Person", function(object) {
cat(object@name, "is", object@age, "years old")
})
hadley
setMethod("show", "Person", function(object, y) {
cat(object@name, "is", object@age, "years old")
})
.Person <- setClass(
"Person",
slots = c(name = "character", age = "numeric")
)
setMethod("show", "Person", function(object) {
cat(is(object)[[1]], "\n",
"  Name: ", object@name, "\n",
"  Age:  ", object@age, "\n",
sep = ""
)
})
hadley <- .Person(name = "Hadley", age = 30)
hadley
formals("show")
setMethod("show", "Person", function(object) {
cat(object@name, "creates hard exercises")
})
hadley
setMethod("show", "Person", function(x) {
cat(x@name, "creates hard exercises")
})
hadley
setMethod("show", "Person", function(x, y) {
cat(x@name, "is", x@age, "years old")
})
setMethod("show", "Person", function(object, y) {
cat(object@name, "is", object@age, "years old")
})
setMethod("show", "Person", function(object) {
cat(object@name, "is", object@age, "years old")
})
hadley
library(tidyverse)
library(methods)
setClass("Person",
slots = c(
name = "character",
age = "numeric"
)
)
john <- new("Person", name = "John Smith", age = NA_real_)
is(john)
john@name
slot(john, "age")
setGeneric("age", function(x) standardGeneric("age"))
setGeneric("age<-", function(x, value) standardGeneric("age<-"))
setMethod("age", "Person", function(x) x@age)
setMethod("age<-", "Person", function(x, value) {
x@age <- value
x
})
age(john) <- 50
age(john)
sloop::otype(john)
sloop::ftype(age)
library(lubridate)
period(c(90, 5), c("second", "minute"))
period(-1, "days")
period(c(3, 1, 2, 13, 1), c("second", "minute", "hour", "day", "week"))
period(c(1, -60), c("hour", "minute"))
period(0, "second")
test_period <- lubridate::period(
c(1, 2, 3, 4, 5, 6, 7),
c("year", "month", "week", "day", "hour", "minute", "second")
)
test_period
str(test_period)
per <- lubridate::period()
str(per)
tibble(name=slotNames(per),
class=map_chr(name, ~ class(getElement(per, .x))))
second(test_period)
setClass("Person",
slots = c(
name = "character",
age = "numeric"
),
prototype = list(
name = NA_character_,
age = NA_real_
)
)
me <- new("Person", name = "Hadley")
str(me)
setClass("Employee",
contains = "Person",
slots = c(
boss = "Person"
),
prototype = list(
boss = new("Person")
)
)
str(new("Employee"))
is(new("Person"))
is(new("Employee"))
is(john, "Person")
setClass("A", slots = c(x = "numeric"))
a <- new("A", x = 10)
setClass("A", slots = c(a_different_slot = "numeric"))
# a <- new("A", a_different_slot = 10)
a
Person <- function(name, age = NA) {
age <- as.double(age)
new("Person", name = name, age = age)
}
Person("Hadley")
Person(mtcars)
Person("Hadley", age = c(30, 37))
setValidity("Person", function(object) {
if (length(object@name) != length(object@age)) {
"@name and @age must be same length"
} else {
TRUE
}
})
Person("Hadley", age = c(30, 37))
alex <- Person("Alex", age = 30)
alex@age <- 1:10
validObject(alex)
# ?utils::person
# Definition of the Person class
setClass("Person",
slots = c(
age = "numeric",
given = "character",
family = "character",
role = "character",
email = "character",
comment = "character"
),
prototype = list(
age = NA_real_,
given = NA_character_,
family = NA_character_,
role = NA_character_,
email = NA_character_,
comment = NA_character_
)
)
# Helper to create instances of the Person class
Person <- function(given, family,
age = NA_real_,
role = NA_character_,
email = NA_character_,
comment = NA_character_) {
age <- as.double(age)
new("Person",
age = age,
given = given,
family = family,
role = role,
email = email,
comment = comment
)
}
# Validator to ensure that each slot is of length one
setValidity("Person", function(object) {
invalids <- c()
if (length(object@age)     != 1 ||
length(object@given)   != 1 ||
length(object@family)  != 1 ||
length(object@email)   != 1 ||
length(object@comment) != 1) {
invalids <- paste0("@name, @age, @given, @family, @email, ",
"@comment must be of length 1")
}
known_roles <- c(
NA_character_, "aut", "com", "cph", "cre", "ctb",
"ctr", "dtc", "fnd", "rev", "ths", "trl"
)
if (!all(object@role %in% known_roles)) {
paste(
"@role(s) must be one of",
paste(known_roles, collapse = ", ")
)
}
if (length(invalids)) return(invalids)
TRUE
})
setClass("Human")
new("Human")
setClass("Programmer", contains = "Human")
new("Programmer")
Programmer <- new("Programmer")
str(Programmer)
setClass("Factor",
slots = c(
data = "integer",
levels = "character",
ordered = "logical"
),
prototype = list(
data = integer(),
levels = character(),
ordered = FALSE
)
)
new("Factor", data = c(1L, 2L), levels = letters[1:3])
setClass("Date2",
slots = list(
data = "integer"
),
prototype = list(
data = integer()
)
)
new("Date2", data = 1L)
setClass("DataFrame",
slots = c(
data = "list",
row.names = "character"
),
prototype = list(
data = list(),
row.names = character(0)
)
)
new("DataFrame", data = list(a = 1, b = 2))
setGeneric("myGeneric", function(x) standardGeneric("myGeneric"))
# Don't do this!
setGeneric("myGeneric", function(x) {
standardGeneric("myGeneric")
})
setGeneric("myGeneric",
function(x, ..., verbose = TRUE) standardGeneric("myGeneric"),
signature = "x"
)
setMethod("myGeneric", "Person", function(x) {
# method implementation
})
args(getGeneric("show"))
setMethod("show", "Person", function(object) {
cat(is(object)[[1]], "\n",
"  Name: ", object@name, "\n",
"  Age:  ", object@age, "\n",
sep = ""
)
})
john
person_name <- function(x) x@name
setGeneric("name", function(x) standardGeneric("name"))
setMethod("name", "Person", function(x) x@name)
name(john)
setGeneric("name<-", function(x, value) standardGeneric("name<-"))
setMethod("name<-", "Person", function(x, value) {
x@name <- value
validObject(x)
x
})
name(john) <- "Jon Smythe"
name(john)
name(john) <- letters
setGeneric("age", function(x) standardGeneric("age"))
setGeneric("age<-", function(x, value) standardGeneric("age<-"))
setMethod("age", "Person", function(x) x@age)
setMethod("age<-", "Person", function(x, value) {
x@age <- value
validObject(x)
x
})
age(john) <- 50
age(john)
age(john) <- 50
setMethod("show", "Person", function(x, y) {
cat(x@name, "is", x@age, "years old")
})
knitr::include_graphics("diagrams/s4/multiple-multiple.png")
install.packages(c("cpp11", "dbplyr", "digest", "downlit", "future", "gargle", "ggfun", "ggplotify", "haven", "igraph", "jsonlite", "KernSmooth", "lme4", "Matrix", "MatrixModels", "mgcv", "pbapply", "pkgbuild", "pkgload", "processx", "Rcpp", "RcppAnnoy", "RcppArmadillo", "readxl", "rgl", "rmarkdown", "robustbase", "rstudioapi", "Seurat", "sf", "shiny", "sp", "spatstat.geom", "spatstat.sparse", "testthat", "twosamples", "usethis", "uwot", "vctrs", "xml2"))
library(rlang)
library(lobstr)
xx <- expr(x + x)
yy <- expr(y + y)
expr(!!xx / !!yy)
cv <- function(var) {
var <- enexpr(var)
expr(sd(!!var) / mean(!!var))
}
cv(x)
cv(x + y)
string_math <- function(x) {
e <- env(
caller_env(),
`+` = function(x, y) paste0(x, y),
`*` = function(x, y) strrep(x, y)
)
eval(enexpr(x), e)
}
name <- "Hadley"
string_math("Hello " + name)
string_math(("x" * 2 + "-y") * 3)
library(dplyr)
con <- DBI::dbConnect(RSQLite::SQLite(), filename = ":memory:")
mtcars_db <- copy_to(con, mtcars)
mtcars_db %>%
filter(cyl > 2) %>%
select(mpg:hp) %>%
head(10) %>%
show_query()
DBI::dbDisconnect(con)
df <- data.frame(x = 1:5, y = sample(5))
df
eval_tidy(expr(x + y), df)
library(rlang)
library(lobstr)
y <- x * 10
z <- rlang::expr(y <- x * 10)
z
x <- 4
eval(z)
y
library(rlang)
library(lobstr)
knitr::include_graphics("diagrams/expressions/simple.png")
library(rlang)
library(lobstr)
ast(f(g(h())))
ast(1 + 2 + 3)
ast((x + y) * z)
ast(f(g(h())))
ast(1 + 2 + 3)
ast((x + y) * z)
f(g(h(i(1, 2, 3))))
ast(f(g(h(i(1, 2, 3)))))
ast(f(1, g(2, h(3, i()))))
ast(f(g(1, 2), h(3, i(4, 5))))
lobstr::ast(`x` + `y`)
lobstr::ast(x ** y)
lobstr::ast(1 -> x)
lobstr::ast(function(x = 1, y = 2) {})
x <- -5
if (x > 0) {
print("Non-negative number")
} else {
print("Negative number")
}
x <- 0
if (x < 0) {
print("Negative number")
} else if (x > 0) {
print("Positive number")
} else
print("Zero")
ast(if (x < 0) {
print("Negative number")
} else if (x > 0) {
print("Positive number")
} else
print("Zero"))
ast(if (x < 0)
print("Negative number")
else if (x > 0)
print("Positive number")
else
print("Zero"))
identical(expr(TRUE), TRUE)
identical(expr(1), 1)
identical(expr(2L), 2L)
identical(expr("x"), "x")
expr(x)
sym("x")
as_string(expr(x))
str(expr(x))
is.symbol(expr(x))
lobstr::ast(read.table("important.csv", row.names = FALSE))
x <- expr(read.table("important.csv", row.names = FALSE))
typeof(x)
is.call(x)
lobstr::ast(read.table("important.csv", row.names = FALSE))
x <- expr(read.table("important.csv", row.names = FALSE))
typeof(x)
is.call(x)
typeof(x)
x[[1]]
is.symbol(x[[1]])
lobstr::ast(foo())
lobstr::ast("foo"())
lobstr::ast(pkg::foo(1))
lobstr::ast(obj$foo(1))
lobstr::ast(foo(1)(2))
knitr::include_graphics("diagrams/expressions/call-call.png")
