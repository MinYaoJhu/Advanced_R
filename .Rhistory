invisible(self)
}
)
)
my_account <- BankAccount$new()
my_account$balance
my_account$
deposit(5)$
withdraw(15)$
balance
BankAccountStrict <- R6Class(
classname = "BankAccountStrict",
inherit = BankAccount,
public = list(
withdraw = function(draw = 0) {
if (self$balance - draw < 0) {
stop("Overdraft! ",
"Your `current balance` is less than your withdraw.",
call. = FALSE
)
}
super$withdraw(draw = draw)
}
)
)
my_strict_account <- BankAccountStrict$new()
my_strict_account$balance
my_strict_account$balance
BankAccountCharging <- R6Class(
classname = "BankAccountCharging",
inherit = BankAccount,
public = list(
withdraw = function(draw = 0) {
if (self$balance - draw < 0) {
draw <- draw + 1
}
super$withdraw(draw = draw)
}
)
)
my_charging_account <- BankAccountCharging$new()
my_charging_account$balance
my_charging_account$
deposit(5)$
withdraw(15)$
withdraw(0)
my_charging_account$balance
suit <- c("♠", "♥", "♦", "♣")
value <- c("A", 2:10, "J", "Q", "K")
cards <- paste0(rep(value, 4), suit)
ShuffledDeck <- R6Class(
classname = "ShuffledDeck",
public = list(
deck = NULL,
initialize = function(deck = cards) {
self$deck <- sample(deck)
},
reshuffle = function() {
self$deck <- sample(cards)
invisible(self)
},
n = function() {
length(self$deck)
},
draw = function(n = 1) {
if (n > self$n()) {
stop("Only ", self$n(), " cards remaining.", call. = FALSE)
}
output <- self$deck[seq_len(n)]
self$deck <- self$deck[-seq_len(n)]
output
}
)
)
my_deck <- ShuffledDeck$new()
my_deck$draw(52)
my_deck$reshuffle()$draw(5)
my_deck$reshuffle()$draw(5)
Timezone <- R6Class(
classname = "Timezone",
public = list(
get = function() {
Sys.timezone()
},
set = function(value) {
stopifnot(value %in% OlsonNames())
old <- self$get()
Sys.setenv(TZ = value)
invisible(old)
}
)
)
tz <- Timezone$new()
old <- tz$set("Antarctica/South_Pole")
tz$get()
tz$set(old)
tz$get()
WorkingDirectory <- R6Class(
classname = "WorkingDirectory",
public = list(
get = function() {
getwd()
},
set = function(value) {
setwd(value)
}
)
)
Person <- R6Class("Person",
public = list(
initialize = function(name, age = NA) {
private$name <- name
private$age <- age
},
print = function(...) {
cat("Person: \n")
cat("  Name: ", private$name, "\n", sep = "")
cat("  Age:  ", private$age, "\n", sep = "")
}
),
private = list(
age = NA,
name = NULL
)
)
hadley3 <- Person$new("Hadley")
hadley3
hadley3$name
Rando <- R6::R6Class("Rando", active = list(
random = function(value) {
if (missing(value)) {
runif(1)
} else {
stop("Can't set `$random`", call. = FALSE)
}
}
))
x <- Rando$new()
x$random
x$random
x$random
Person <- R6Class("Person",
private = list(
.age = NA,
.name = NULL
),
active = list(
age = function(value) {
if (missing(value)) {
private$.age
} else {
stop("`$age` is read only", call. = FALSE)
}
},
name = function(value) {
if (missing(value)) {
private$.name
} else {
stopifnot(is.character(value), length(value) == 1)
private$.name <- value
self
}
}
),
public = list(
initialize = function(name, age = NA) {
private$.name <- name
private$.age <- age
}
)
)
hadley4 <- Person$new("Hadley", age = 38)
hadley4$name
hadley4$name <- 10
hadley4$age <- 20
BankAccountStrictError <- R6Class(
classname = "BankAccountStrictError",
public = list(
deposit = function(dep = 0) {
private$balance <- private$balance + dep
invisible(self)
},
withdraw = function(draw = 0) {
if (private$balance - draw < 0) {
stop(
"Your `withdraw` must be smaller ",
"than your `balance`.",
call. = FALSE
)
}
private$balance <- private$balance - draw
invisible(self)
}
),
private = list(
balance = 0
)
)
my_account_strict_error <- BankAccountStrictError$new()
my_account_strict_error$deposit(5)
my_account_strict_error$withdraw(10)
Password <- R6Class(
classname = "Password",
public = list(
print = function(...) {
cat("<Password>: ********\n")
invisible(self)
},
set = function(value) {
private$password <- value
},
check = function(password) {
identical(password, private$password)
}
),
private = list(
password = NULL
)
)
my_pw <- Password$new()
my_pw$set("This_is_my_password!")
my_pw$password
my_pw
my_pw$check("Thisismypassword")
my_pw$check("This_is_my_password!")
Rando <- R6::R6Class(
classname = "Rando",
private = list(
last_random = NULL
),
active = list(
random = function(value) {
if (missing(value)) {
private$last_random <- runif(1)
private$last_random
} else {
stop("Can't set `$random`.", call. = FALSE)
}
},
previous = function(value) {
if (missing(value)) {
private$last_random
}
}
)
)
x <- Rando$new()
x$random
x$random
x$previous
ParentClass <- R6Class(
classname = "ParentClass",
private = list(
field = "apple",
method = function() {
"juice"
}
)
)
SubClass <- R6Class(
classname = "SubClass",
inherit = ParentClass,
public = list(
test = function() {
cat("Field:  ", super$field, "\n", sep = "")
cat("Method: ", super$method(), "\n", sep = "")
}
)
)
SubClass$new()$test()
y1 <- Accumulator$new()
y2 <- y1
y1$add(10)
c(y1 = y1$sum, y2 = y2$sum)
y1 <- Accumulator$new()
y2 <- y1$clone()
y1$add(10)
c(y1 = y1$sum, y2 = y2$sum)
x <- factor(c("a", "b", "c"))
levels(x) <- c("c", "b", "a")
TemporaryFile <- R6Class("TemporaryFile", list(
path = NULL,
initialize = function() {
self$path <- tempfile()
},
finalize = function() {
message("Cleaning up ", self$path)
unlink(self$path)
}
))
tf <- TemporaryFile$new()
rm(tf)
#> Cleaning up /tmp/Rtmpk73JdI/file155f31d8424bd
TemporaryDatabase <- R6Class("TemporaryDatabase", list(
con = NULL,
file = TemporaryFile$new(),
initialize = function() {
self$con <- DBI::dbConnect(RSQLite::SQLite(), path = file$path)
},
finalize = function() {
DBI::dbDisconnect(self$con)
}
))
db_a <- TemporaryDatabase$new()
db_b <- TemporaryDatabase$new()
db_a$file$path == db_b$file$path
TemporaryDatabase <- R6Class("TemporaryDatabase", list(
con = NULL,
file = NULL,
initialize = function() {
self$file <- TemporaryFile$new()
self$con <- DBI::dbConnect(RSQLite::SQLite(), path = file$path)
},
finalize = function() {
DBI::dbDisconnect(self$con)
}
))
db_a <- TemporaryDatabase$new()
db_b <- TemporaryDatabase$new()
db_a$file$path == db_b$file$path
WriteFile <- R6::R6Class(
classname = "WriteFile",
public = list(
con = NULL,
initialize = function(filename) {
self$con <- file(filename, open = "a")
},
append_line = function(x) {
cat(x, "\n", sep = "", file = self$con)
},
finalize = function() {
close(self$con)
}
)
)
tmp_file <- tempfile()
test_writer <- WriteFile$new(tmp_file)
readLines(tmp_file)
test_writer$append_line("First")
test_writer$append_line("Second")
readLines(tmp_file)
install.packages("emoji")
library(emoji)
library(methods)
setClass("Person",
slots = c(
name = "character",
age = "numeric"
)
)
john <- new("Person", name = "John Smith", age = NA_real_)
is(john)
john@name
slot(john, "age")
setGeneric("age", function(x) standardGeneric("age"))
setGeneric("age<-", function(x, value) standardGeneric("age<-"))
setMethod("age", "Person", function(x) x@age)
setMethod("age<-", "Person", function(x, value) {
x@age <- value
x
})
age(john) <- 50
age(john)
sloop::otype(john)
sloop::ftype(age)
setClass("Person",
slots = c(
name = "character",
age = "numeric"
),
prototype = list(
name = NA_character_,
age = NA_real_
)
)
me <- new("Person", name = "Hadley")
str(me)
setClass("Employee",
contains = "Person",
slots = c(
boss = "Person"
),
prototype = list(
boss = new("Person")
)
)
str(new("Employee"))
is(new("Person"))
is(new("Employee"))
is(john, "Person")
setClass("A", slots = c(x = "numeric"))
a <- new("A", x = 10)
setClass("A", slots = c(a_different_slot = "numeric"))
a
Person <- function(name, age = NA) {
age <- as.double(age)
new("Person", name = name, age = age)
}
Person("Hadley")
Person(mtcars)
Person("Hadley", age = c(30, 37))
setValidity("Person", function(object) {
if (length(object@name) != length(object@age)) {
"@name and @age must be same length"
} else {
TRUE
}
})
Person("Hadley", age = c(30, 37))
alex <- Person("Alex", age = 30)
alex@age <- 1:10
validObject(alex)
setGeneric("myGeneric", function(x) standardGeneric("myGeneric"))
# Don't do this!
setGeneric("myGeneric", function(x) {
standardGeneric("myGeneric")
})
setGeneric("myGeneric",
function(x, ..., verbose = TRUE) standardGeneric("myGeneric"),
signature = "x"
)
setMethod("myGeneric", "Person", function(x) {
# method implementation
})
args(getGeneric("show"))
setMethod("show", "Person", function(object) {
cat(is(object)[[1]], "\n",
"  Name: ", object@name, "\n",
"  Age:  ", object@age, "\n",
sep = ""
)
})
john
person_name <- function(x) x@name
setGeneric("name", function(x) standardGeneric("name"))
setMethod("name", "Person", function(x) x@name)
name(john)
setGeneric("name<-", function(x, value) standardGeneric("name<-"))
setMethod("name<-", "Person", function(x, value) {
x@name <- value
validObject(x)
x
})
name(john) <- "Jon Smythe"
name(john)
name(john) <- letters
knitr::include_graphics("diagrams/s4/emoji.png")
library(emoji)
knitr::include_graphics("diagrams/s4/single.png")
knitr::include_graphics("diagrams/s4/single-any.png")
knitr::include_graphics("diagrams/s4/multiple.png")
knitr::include_graphics("diagrams/s4/multiple-ambig.png")
knitr::include_graphics("diagrams/s4/multiple-ambig-2.png")
knitr::include_graphics("diagrams/s4/multiple-any.png")
knitr::include_graphics("diagrams/s4/multiple-all.png")
knitr::include_graphics("diagrams/s4/single-single.png")
knitr::include_graphics("diagrams/s4/single-single-ambig.png")
knitr::include_graphics("diagrams/s4/single-multiple.png")
knitr::include_graphics("diagrams/s4/multiple-multiple.png")
RangedNumeric <- setClass(
"RangedNumeric",
contains = "numeric",
slots = c(min = "numeric", max = "numeric"),
prototype = structure(numeric(), min = NA_real_, max = NA_real_)
)
rn <- RangedNumeric(1:10, min = 1, max = 10)
rn@min
rn@.Data
setGeneric("mean")
selectMethod("mean", "ANY")
period(c(90, 5), c("second", "minute"))
library(lubridate)
period(c(90, 5), c("second", "minute"))
period(-1, "days")
period(c(90, 5), c("second", "minute"))
period(-1, "days")
period(c(3, 1, 2, 13, 1), c("second", "minute", "hour", "day", "week"))
library(lubridate)
period(c(90, 5), c("second", "minute"))
period(-1, "days")
period(c(3, 1, 2, 13, 1), c("second", "minute", "hour", "day", "week"))
period(c(1, -60), c("hour", "minute"))
period(0, "second")
example_12345 <- lubridate::period(
c(1, 2, 3, 4, 5),
c("year", "month", "day", "hour", "minute", "second")
)
test_period <- lubridate::period(
c(1, 2, 3, 4, 5, 6),
c("year", "month", "day", "hour", "minute", "second")
)
test_period
str(test_period)
setClass("A", slots = c(x = "numeric"))
a <- new("A", x = 10)
setClass("A", slots = c(a_different_slot = "numeric"))
a
setClass("A", slots = c(x = "numeric"))
a <- new("A", x = 10)
setClass("A", slots = c(a_different_slot = "numeric"))
a <- new("A", x = 10)
a
setClass("A", slots = c(x = "numeric"))
a <- new("A", x = 10)
setClass("A", slots = c(a_different_slot = "numeric"))
a <- new("A", a_different_slot = 10)
a
setClass("A", slots = c(x = "numeric"))
a <- new("A", x = 10)
setClass("A", slots = c(a_different_slot = "numeric"))
# a <- new("A", a_different_slot = 10)
a
